{% extends "blog/base.html" %}

{% load django_bootstrap5 %}

{% block title %}
    文章列表 - Django 大冒險
{% endblock title %}

{% block extra_head %}
    {% comment %}
    表引入預設的主題
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/tom-select@2.4.3/dist/css/tom-select.default.min.css"> {% endcomment %}
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/tom-select@2.4.3/dist/css/tom-select.bootstrap5.min.css">
{% endblock extra_head %}

{% block extra_scripts %}
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.4.3/dist/js/tom-select.complete.min.js"></script>

    <script>
        // 撈取全部所指定的物件
        document.querySelectorAll('select[multiple]').forEach((el) => {
            new TomSelect(el, {
                plugins: ['remove_button'],
                create: false,
                placeholder: '請選擇項目......',
            });
        });
    </script>

    <script>
        /* // 處理批次刪除的全選
        document.getElementById('select-all-article').addEventListener('change', function() {
            // console.log('hihi') //由F12主控台可以看到選取變化時，得到hihi
            // document.querySelectorAll('.article-checkbox') // 找全部的article-checkbox
            document.querySelectorAll('.article-checkbox').forEach((checkbox) => {
                checkbox.checked = this.checked
            })
        })*/
        document.addEventListener('change', function (e) {

            const selectAllCheckbox = document.getElementById('select-all-article')

            // 點擊「全選」
            if (e.target.id === 'select-all-article') {
                document.querySelectorAll('.article-checkbox').forEach(cb => {
                    cb.checked = e.target.checked
                })
                return
            }

            // 點擊任一文章 checkbox
            if (e.target.classList.contains('article-checkbox')) {
                const articleCheckboxes = document.querySelectorAll('.article-checkbox')
                // console.log(articleCheckboxes)
                const allChecked = Array.from(articleCheckboxes).every(cb => cb.checked)
                selectAllCheckbox.checked = allChecked
            }
        })
    </script>
{% endblock extra_scripts %}

{% block blog_content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>
            文章列表
        </h2>
        <a href="{% url 'blog:article_create' %}" class="btn btn-primary">
            建立文章
        </a>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">
                篩選條件
            </h5>
            <form method="get">
                {% comment %} filter.form是最標準的Django form {% endcomment %}
                {% bootstrap_form filter.form %}

                <div class="d-flex gap-2">
                    {% bootstrap_button button_type="submit" content="搜尋" %}
                    <a href="{% url 'blog:article_list' %}" class="btn btn-secondary">清除</a>
                </div>
            </form>
        </div>
    </div>
    <form method="post" action="{% url "blog:article_bulk_delete" %}">
        {% csrf_token %}

        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="select-all-article">
                <label for="select-all-article">
                    全選
                </label>
            </div>

            <button type="submit" class="btn btn-danger">
                批次刪除
            </button>
        </div>

        <div class="row">
            {% comment %} filter.qs表經過過濾過後的資料 {% endcomment %}
            {% for article in filter.qs %}
                {% include "blog/components/article_card.html" with show_check_box=True %}
            {% empty %}
                <div class="col-12">
                    <div class="alert alert-info">
                        沒有符合條件的文章
                    </div>
                </div>
            {% endfor %}
        </div>
    </form>
{% endblock blog_content %}
